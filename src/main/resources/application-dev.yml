server:
  port: ${PORT:8080}
  tomcat:
    max-swallow-size: 500MB
    max-http-form-post-size: 500MB
  connection-timeout: 120000ms
  servlet:
    multipart:
      max-file-size: 500MB
      max-request-size: 500MB
      file-size-threshold: 2KB
      enabled: true

spring:

  # ===============================
  # Mail Service
  # ===============================
  mail:
    host: ${SMTP_HOST:smtp.example.com}
    port: ${SMTP_PORT:587}
    username: ${SMTP_USER:username}
    password: ${SMTP_PASSWORD:password}
    protocol: smtp
    default-encoding: UTF-8
    properties:
      mail.smtp.auth: true
      mail.smtp.starttls.enable: true
      mail.smtp.starttls.required: true
      mail.debug: true

  application:
    name: user-service

  datasource:
    username: ${POSTGRES_USER}
    password: ${POSTGRES_PASSWORD}
    url: jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        database-platform: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
    show-sql: true

  servlet:
    multipart:
      max-file-size: 500MB
      max-request-size: 500MB
      enabled: true

  mvc:
    servlet:
      path: ${BASE_PATH:/api}

  flyway:
    enabled: true
    baseline-on-migrate: true

# ===============================
# Actuator + Prometheus
# ===============================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    prometheus:
      enabled: true
    health:
      show-details: when_authorized
  metrics:
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5,0.75,0.95,0.99
    tags:
      application: ${spring.application.name}

# ===============================
# Sentry
# ===============================
sentry:
  dsn: ${SENTRY_DSN}
  tracesSampleRate: 1.0

# ===============================
# Resilience4j
# ===============================
resilience4j:
  ratelimiter:
    instances:
      userService:
        limitForPeriod: 10
        limitRefreshPeriod: 1s
        timeoutDuration: 500ms

# ===============================
# JWT
# ===============================
jwt:
  private-key-path: ${JWT_PRIVATE_KEY}
  public-key-path: ${JWT_PUBLIC_KEY}
  expiration-ms: 3600000

# ===============================
# MinIO / S3
# ===============================
cloud:
  aws:
    credentials:
      accessKey: ${MINIO_ACCESS_KEY:minioadmin}
      secretKey: ${MINIO_SECRET_KEY:minioadmin123}
    region:
      static: us-east-1
    s3:
      bucket: ${MINIO_BUCKET:user-service}
      path-style-access-enabled: true
      endpoint: ${MINIO_ENDPOINT:http://127.0.0.1:9000}

app:
  frontend-url: ${FRONTEND_URL:http://localhost:3000}